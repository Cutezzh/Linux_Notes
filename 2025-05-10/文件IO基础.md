### 文件描述符

1. 在 open函数执行成功的情况下，会返回一个非负整数，该返回值就是一个文件描述符（file descriptor）  

2. 在 Linux 系统下，我们可以通过 ulimit 命令来查看进程可打开的最大文件数(默认最大值是1024)
   ```shell
   ulimit -n
   ```

3. 0、 1、 2 这三个文件描述符已经默认被系统占用了，分别分配给了系统标准输入（0）、标准输出（1）以及标准错误（2）

4. Linux 系统下，一切皆文件，也包括各种硬件设备  

### open打开文件

1. 函数原型
   ```c
   #include <sys/types.h>
   #include <sys/stat.h>
   #include <fcntl.h>
   int open(const char *pathname, int flags);
   int open(const char *pathname, int flags, mode_t mode);
   //C语言不支持重载，这里用的是可变参数
   ```

2. pathname：需要打开或创建的文件，可以包含路径（绝对路径或相对路径）信息  

3. flags：文件访问模式标志以及其它文件相关标志，常用的如下 

   | 标志        | 用途                                                         |
   | ----------- | ------------------------------------------------------------ |
   | O_RDONLY    | 以只读方式打开文件                                           |
   | O_WRONLY    | 以只写方式打开文件                                           |
   | O_RDWR      | 以可读可写方式打开文件                                       |
   | O_CREAT     | 如果 pathname 参数指向的文件不存在则创建此文件               |
   | O_DIRECTORY | 如果 pathname 参数指向的不是一个目录，则调用 open 失败       |
   | O_EXCL      | 一般结合 O_CREAT 标志一起使用，用于专门创建文件。同时使用时，如果 pathname 参数指向的文件已经存在，则 open 函数返回错误 |
   | O_NOFOLLOW  | 如果 pathname 参数指向的是一个符号链接，将不对其进行解引用，直接返回错误 |

4. mode：用于指定新建文件的访问权限，只有当 flags 参数中包含 O_CREAT 或 O_TMPFILE 标志时才有效（O_TMPFILE 标志用于创建一个临时文件） 

5. 返回值： 成功将返回文件描述符，文件描述符是一个非负整数；失败将返回-1。

6. man命令可以将该系统调用的详细信息显示出来，譬如函数功能介绍、函数原型、参数、返回值以及使用该函数所需包含的头文件等信息。比如Linux 命令（对应数字 1）、系统调用（对应数字2）、标准 C 库函数（对应数字 3）  

### write写文件

1. 函数原型
   ```c
   #include <unistd.h>
   ssize_t write(int fd, const void *buf, size_t count);
   ```

2. fd：文件描述符  

3. buf：指定写入数据对应的缓冲区  

4. count：指定写入的字节数  

5. 返回值：如果成功将返回写入的字节数（0 表示未写入任何字节），如果此数字小于 count 参数，这不是错误，譬如磁盘空间已满，可能会发生这种情况；如果写入出错，则返回-1。

6. 默认情况下当前位置偏移量一般是 0，也就是指向了文件起始位置  

7. 调用 read、 write 函数读写操作完成之后，当前位置偏移量也会向后移动对应字节数  

### read读文件

1. 函数原型
   ```c
   #include <unistd.h>
   ssize_t read(int fd, void *buf, size_t count);
   ```

2. fd：文件描述符  

3. buf：指定用于存储读取数据的缓冲区    

4. count：指定需要读取的字节数 

5. 返回值：读取成功将返回读取到的字节数  可能小于count（剩余字节数据少于count，下次读取便会返回0），可能为0（到达文件末尾）

### close关闭文件

1. 函数原型
   ```c
   #include <unistd.h>
   int close(int fd);
   ```

2. fd： 文件描述符，需要关闭的文件所对应的文件描述符。

3. 返回值： 如果成功返回0，如果失败则返回-1。

### lseek

1. 函数原型
   ```c
   #include <sys/types.h>
   #include <unistd.h>
   off_t lseek(int fd, off_t offset, int whence);
   ```

2. fd： 文件描述符。

3. offset： 偏移量，以字节为单位。

4. whence： 用于定义参数 offset 偏移量对应的参考值

   | 宏       | 说明                                                         |
   | -------- | ------------------------------------------------------------ |
   | SEEK_SET | 读写偏移量将指向 offset 字节位置处（从文件头部开始算）       |
   | SEEK_CUR | 读写偏移量将指向==当前位置==偏移量 + offset 字节位置处， offset 可正可负，正数往后偏移，负数往前偏移 |
   | SEEK_END | 读写偏移量将指向==文件末尾== + offset 字节位置处，同样可正可负 |

5. 返回值：成功将返回从文件头部开始算起的位置偏移量（字节为单位），也就是当前的读写位置；发生错误将返回-1。

6. 在Linux 系统下，绝大部分的函数都是返回 0 作为函数调用成功的标识、而返回负数（譬如-1）表示函数调用失败。